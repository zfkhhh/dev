redis常用于缓存数据，因为redis是内存数据库，内存操作的速度是磁盘操作速度10-1000倍；作为缓存，有缓存穿透、缓存击穿、缓存雪崩问题

一、缓存雪崩
1. 缓存雪崩是指大量缓存过期失效或者redis宕机，导致大量请求查询数据库，导致数据库压力骤增
2. 解决方案：
2.1 随机过期时间，设置key过期时间时，尽量加上一个随机数
2.2 查询数据库互斥，当缓存不存在时，先获得互斥锁在去查数据库，缓存数据
2.3 业务不再生成缓存，由缓存服务提供缓存，将缓存设置为不过期，redis会通过内存淘汰删除缓存数据，解决方案一个是缓存服务需要频繁检测缓存是否过期，过期就读数据库重写缓存；一个是业务系统查询时发现缓存过期通过消息队列通知后台更新缓存

二、缓存击穿
1. 缓存击穿是指热点key过期导致大量请求数据库
2. 解决方案也是可以查询数据库互斥，或者缓存不过期，通过缓存服务处理

三、缓存穿透
1. 穿透指查询的数据即不在缓存里也不在数据库里，大量请求到了数据库
2. 解决方案是
2.1 限制非法请求
2.2 查询不到数据也缓存空值或零值
2.3 使用布隆过滤器，每次查数据库前先判断布隆过滤器中是否存在，不存在就不去查数据库；写入数据库时在布隆过滤器标记

四、布隆过滤器
1. 布隆过滤器基于bitmap,初始是都为0；当标记数据时，对key进行n个hash函数计算多个模值，在bitmap多个位置标记1;查询数据是否存在时需要查多个hash值上是否标记1，只要有一个0就说明数据不存在
2. 因为hash冲突的问题，布隆过滤器不能完全确认数据存在，但能完全确认数据不存在

五、缓存数据
1. 常用更新缓存数据的方案：先写数据库再更新缓存；先更新缓存再写数据库；但不管哪个方案都会有并发问题，更新数据库到更新缓存不是原子的
2. 删除缓存替代更新缓存，也叫旁路缓存策略，让读数据的时候再重写加载缓存
3. 对于先删缓存还是先更新数据库，选择先更新数据库，再删缓存，明显缓存写入速度更快，要在数据库更新前读到旧数据，到删缓存后写入这个旧缓存，这个可能较小
4. 虽然概率较小还是有并发问题，那就延长数据库更新到缓存删除的时间，保证读到旧数据的写入缓存操作会被删掉，也就是延迟双删
4.1 延迟双删用两次删除，先删除缓存，再更新数据库，然后睡眠一个随机时间，再删除一次缓存
5. 如果对命中缓存有强要求，可以采用两种方案
5.1 不删除缓存，还是使用更新缓存，在更新数据库后，需要获得分布式锁，拿到锁后才能更新缓存
5.2 缓存过期时间设置较小，就算读到旧数据也会很快过期
6. 考虑写缓存失败，需要加重试机制；也就是异步去操作
6.1 可以引入消息队列，将删除操作作为消息发送到消息队列，服务读到消息删除缓存，失败重试
6.2 订阅binlog（Canal 中间件），接收到binlog的修改，就去删除缓存
