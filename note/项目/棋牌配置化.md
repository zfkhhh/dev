1. 各个地区的棋牌游戏都有自己的特色玩法，主线流程通用，想要快速搭建一款棋牌游戏，需要实现好主线流程，支持额外玩法的可插拔，额外玩法通过中间件的形式加入主线流程中
2. 难度在两点：
2.1 如何实现一个可扩展的主线流程，定义玩法的插入方式，并且无论插入多少款玩法都不会影响游戏流程
2.2 如何实现低耦合的玩法模块，玩法模块如何影响游戏数据
3. 游戏流程
3.1 设计游戏逻辑接口及实现对象，包含规则配置，进桌、准备、重连、离开等接口
3.2 游戏逻辑对象：游戏状态机、游戏桌子对象、游戏规则、运行时数据模块、消息通知接口、游戏流程行为与动作接口
3.3 游戏进行基于两种方式：状态机流转、事件驱动
3.3.1 状态机流转：创建规则时初始化了状态机定义的所有游戏流程，及进出流程要执行的事件；初始时状态机处于准备阶段，当所有玩家都完成准备事件，游戏开始数据准备，然后状态机流转到下一状态发牌状态
3.3.2 状态机的状态是顺序进行的，如果有玩法要插入主流程，需要实现状态机进出接口，并注册新状态设置顺序
3.3.3 事件驱动：状态机是游戏进行到某个阶段，阶段内怎么进行游戏，是基于事件驱动，创建规则时各种玩法里面的用户行为实现了动作接口，动作中涉及到客户端服务端消息通讯实现了消息通知接口，并设计了定时器
3.3.4 定义每个状态可以执行的事件和事件的实现方法
4. 可扩展性的设计
4.1 模块化：基础模块与运行时模块，基础模块是游戏运行需要的基本逻辑，如牌堆基础数据、动作限制、番种设计与听牌胡牌；运行时模块是游戏运行中执行的逻辑模块，如准备、发牌、行牌、结算模块、额外玩法模块如换牌、精牌；每个模块相互独立，运行时模块会引用基础模块函数，并且对游戏逻辑对象中的运行时数据模块的修改
4.1.1 模块化设计实现了，一条游戏运行主线，准备、发牌、行牌、结算，基础模块作为被引用，额外玩法作为插件插入主线流程中
4.2 面向接口
4.2.1 定义了顶级接口状态机interface，每个状态都需要实现进出状态机接口；优点在于状态机初始化时解耦，每个实现的状态都可以注入状态机
4.2.2 流程的控制器和处理单元定义成接口注册到游戏逻辑对象；这样做的好处，定义好了默认实现，在子游戏layout中只要引入了流程对象就可以走完流程控制，而自定义某个流程只需要重写某个流程控制方法
4.2.3 面向接口也可以解决循环依赖问题
4.3 事件驱动：将事件列表和对应的流程处理方法注册到状态机的事件列表，事件是游戏进行过程客户端与服务端间的通信，事件的执行函数会修改游戏运行时数据，以进行游戏流程
5. 额外玩法的接入
5.1 如果额外玩法需要作为一个状态，可以通过实现状态机接口，然后加入状态机列表，运行时状态切换
5.2 游戏运行数据中存在中间件列表，中间件是在某个操作函数后执行，当然操作函数那得调用中间件执行
5.3 注册事件，和客户端定义消息，对应的操作函数