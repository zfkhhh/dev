一、游戏数据包丢失怎么办


二、游戏重连，怎么保证快速重连
1. 重连主要就是两方面：链接的恢复，客户端游戏状态的恢复
2. 链接的恢复：connectsrv保存用户的链接，随着心跳检测链接被close，恢复重连时客户端重新发起tcp连接请求，负载均衡到某一个connectsrv，三次握手建立tcp链接
3. 客户端游戏状态的恢复：因为客户端和服务端都保存着sokectContext，能通过connectsrv找到游戏进程，然后定位到进程中的游戏桌子，接下来就是客户端发送重连消息
3.1 这里会广播用户状态给牌桌的其他用户，包括用户上线、地理位置信息、离线信息
3.2 单发给重连用户棋牌数据，这里无脑下发游戏规则、当前游戏状态、游戏数据如牌堆手牌；如果正在行牌阶段，就会下发当前吃碰杠动作或者定时器等等
3.3 这里其实可以优化：客户端的断连其实并不一定丢失了所有的数据，所以发送重连消息其实可以附带上客户端状态的，比如网络断线，只需要重发断连期间的消息，让客户端快速播放就会有较好的体验，可以这样设计：客户端发送重连时根据本地缓存，判断是完全的重发，还是重发部分数据，如果是重发部分数据，带上消息序列号，服务端记录了EventBus事件总线，发送断连消息到最后消息即可恢复，这还需要客户端缓存事件

三、链接服务，服务异常了怎么处理链接
1. 链路服务器保存了用户的链接以及所有服务都链接
2. 与所有服务都链接重启的时候就会重新连上
3. 保存了一定用户的链接，以及将connectsrvId与sessionId关联上，并且通过proxy指向当前connectsrv
3.1 服务异常就是从proxy到connectsrv数据不通，这个时候就需要向其他的connectsrv建连，向客户端返回异常，sessionsrv上报sessionId与connectsrv链接异常，客户端重新与connectsrv发送连接请求

四、一个app卡顿问题
1. 省内多平台出现tcp请求卡顿，经定位是connectsrv到gamedispatcher阻塞
1.1. connectsrv内部维护了到gamedispatcher的线程池，默认是3个链接，改成16个
1.2. 房间清理消息处理异步化
2. connectproxy与connectsrv链接被关闭，用户请求无响应；增加proxy与connect的处理，当旧链接失效，重新申请新链接
3. connectsrv服务直接发布是有损的；每次发布需要进行摘流，不然会有大量客户端请求重连
3.1 proxy连接数异常，因为connectsrv重启导致destId未清除，子游戏到proxy的连接池未关闭，随着destId未续约被清理，重启子游戏就不会建立连接